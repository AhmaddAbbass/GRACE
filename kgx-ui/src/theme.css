/* ====== Design tokens ====== */
:root{
  --bg: #f6f7fb;
  --panel: #ffffff;
  --ink: #111;
  --muted: #666;
  --border: rgba(0,0,0,.08);

  --brand: #1E88E5;
  --accent: #10A37F;

  --chat-bg: #202123;
  --chat-bubble: #444654;
  --chat-user: #10A37F;
  --chat-ink: #ECECF1;

  --r: 12px;
  --sm: 8px;
  --md: 16px;
  --lg: 24px;

  font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  color-scheme: light;
}

html, body, #root { height: 100%; margin: 0; }
body { background: var(--bg); color: var(--ink); }

/* ====== Top bar ====== */
.topbar{
  display:flex; align-items:center; gap:12px;
  padding:10px 12px;
  background:var(--panel);
  border-bottom:1px solid var(--border);
  position:sticky; top:0; z-index:5;
}
.topbar__left{ display:flex; align-items:center; }
.brand{ display:flex; align-items:center; gap:10px; }
.brand__logo{ font-size:20px; }
.brand__title{ font-weight:600; }
.brand__sub{ font-size:12px; color:var(--muted); }

.topbar__center{ display:flex; align-items:center; gap:10px; flex:1; }
.chip{ display:inline-flex; align-items:center; gap:6px; padding:6px 8px; border:1px solid var(--border); border-radius:999px; background:#fff; font-size:13px; }
.chip__input{ width:56px; height:24px; border:1px solid var(--border); border-radius:6px; padding:0 6px; font-size:12px; }
.status-dot{ display:flex; align-items:center; gap:6px; color:var(--muted); font-size:12px; }
.status-dot .dot{ width:8px; height:8px; border-radius:50%; background:var(--accent); animation:pulse 1.6s infinite; }
@keyframes pulse { 0%{opacity:1} 50%{opacity:.5} 100%{opacity:1} }

.topbar__right{ display:flex; align-items:center; gap:8px; }
.btn, .icon-btn{
  border:1px solid var(--border); background:#fff; border-radius:10px;
  height:30px; padding:0 10px; cursor:pointer;
}
.btn:disabled{ opacity:.5; cursor:default; }

/* ====== Shell layout ====== */
.app-shell{ height:100%; display:flex; flex-direction:column; }
.shell-body{
  flex:1; display:grid; grid-template-columns: 360px 1fr; gap:10px;
  padding:10px;
  height:calc(100vh - 64px);  min-height:0;  box-sizing:border-box;  overflow:hidden; }
.shell-left{ height:100%; display:flex; flex-direction:column; overflow:hidden; }
.shell-right{ height:100%; display:flex; flex-direction:column; overflow:hidden; }

/* ====== ChatDock ====== */
.chatdock{
  height:100%; display:flex; flex-direction:column;
  background: var(--chat-bg);
  color: var(--chat-ink);
  border:1px solid var(--border);
  border-radius: var(--r);
  overflow: hidden;
}
.chatdock__header{
  display:flex; align-items:center; justify-content:space-between;
  padding:12px; border-bottom:1px solid #2a2b31;
}
.chatdock__title{ font-weight:600; }
.chatdock__subtitle{ font-size:12px; color:#bdbfc6; margin-top:2px; }
.icon-btn{ background:#2a2b31; color:#fff; border:1px solid #3a3b41; border-radius:8px; height:28px; width:28px; cursor:pointer; }

.chatdock__messages{ flex:1; overflow:auto; padding:12px; display:flex; flex-direction:column; gap:12px; }
.notice{ background:#2a2b31; color:#d8d9df; border:1px dashed #3a3b41; border-radius:10px; padding:10px; font-size:14px; position:relative; }
.notice--error{ background:#b3261e; border-color:#ffb4a9; color:#fff; }
.notice__close{ position:absolute; right:8px; top:8px; background:transparent; color:#fff; border:none; cursor:pointer; }

.empty{ text-align:center; color:#bdbfc6; padding:20px 8px; }
.empty__icon{ font-size:28px; margin-bottom:8px; }
.empty__hint{ font-size:12px; margin-top:4px; }

.bubble{
  max-width:85%;
  display:flex; flex-direction:column;
}
.bubble.user{ align-self:flex-end; }
.bubble.assistant{ align-self:flex-start; }

.bubble__body{
  background: var(--chat-bubble);
  border:1px solid #3a3b41;
  color: var(--chat-ink);
  border-radius: 12px;
  padding:10px 12px;
  line-height:1.45;
}
.bubble.user .bubble__body{
  background: var(--chat-user);
  border-color: transparent;
  color: white;
}
.bubble.is-active .bubble__body{ box-shadow: 0 0 0 2px var(--brand); }

.bubble__meta{
  margin-top:6px; font-size:12px; color:#cfd1d8; display:flex; align-items:center; gap:6px;
}
.bubble__ts{ font-size:12px; color:#bdbfc6; margin-top:4px; align-self:flex-end; }

.dots{ display:inline-flex; gap:3px; margin-right:8px; }
.dots i{ width:6px; height:6px; border-radius:50%; background:#cfd1d8; animation:typing 1.3s infinite ease-in-out; }
.dots i:nth-child(1){ animation-delay:-.32s }
.dots i:nth-child(2){ animation-delay:-.16s }
@keyframes typing{ 0%,80%,100%{ transform: scale(.8); opacity:.5 } 40%{ transform: scale(1); opacity:1 } }

.chatdock__input{
  padding:10px; border-top:1px solid #2a2b31; display:flex; gap:8px; align-items:flex-end;
}
.chat-input{
  flex:1; min-height:40px; max-height:120px; resize:none;
  background:#2a2b31; color:#fff; border:1px solid #3a3b41; border-radius:10px;
  padding:8px 10px; font-size:14px; outline:none;
}
.chat-input:focus{ border-color:#5b9bff; box-shadow:0 0 0 2px rgba(91,155,255,.25) }
.send-btn{
  height:40px; padding:0 12px; border-radius:10px; border:none; cursor:pointer;
  background: var(--chat-user); color:#fff; font-weight:600;
}
.send-btn:disabled{ opacity:.5; cursor:default; }
.chatdock__hint{ text-align:center; color:#9fa2ac; font-size:11px; padding:8px 10px 12px; }

/* ====== Panels / Graph host ====== */
.panel{
  height:100%;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius: var(--r);
  padding:0;
  position:relative;
  overflow:hidden;
}
.graph-host{ display:block; height:100%; }
.graph-viewport{ width:100%; height:100%; min-height:0; }

/* ====== Legend ====== */
.legend{
  position:absolute; right:16px; top:16px;
  width:260px; max-height:40vh; overflow:auto;
  background:#fff; border:1px solid var(--border); border-radius:12px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  padding:10px 12px 12px; z-index:2;
}
.legend__close{
  position:sticky; top:0; margin-left:auto;
  width:22px; height:22px; border:1px solid var(--border); border-radius:999px;
  background:#fff; cursor:pointer; display:flex; align-items:center; justify-content:center;
}
.legend__title{ font-size:13px; font-weight:600; border-bottom:1px solid rgba(0,0,0,0.06); padding:6px 0; }
.legend__section{ font-size:12px; font-weight:600; margin:8px 0 6px; color:#444; }
.legend__list{ list-style:none; padding:0; margin:8px 0 10px; }
.legend__list li{
  display:grid; grid-template-columns:16px 1fr; align-items:center;
  column-gap:8px; row-gap:6px; line-height:1.25; margin-bottom:4px;
}
.swatch{ width:14px; height:14px; border-radius:4px; border:1.5px solid rgba(0,0,0,0.15); background:var(--swatch-bg, #ccc); }
.swatch--hit{ --swatch-bg:#dc143c; box-shadow:0 0 6px rgba(255,8,68,.6); border-color:#b22222; }
.swatch--path-edge{ width:18px; height:0; border:none; border-top:2px solid #FB8C00; border-radius:0; }
.swatch--bridge{ width:18px; height:0; border-top:2px dashed #FB8C00; }
.legend-toggle{
  position:absolute; right:16px; top:16px; z-index:2;
  width:28px; height:28px; border:1px solid var(--border); background:#fff; border-radius:999px; cursor:pointer;
}

/* ====== Drawer (SideInfo) ====== */
.drawer-backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,0.35); z-index:8;
}
.drawer{
  position:fixed; top:0; right:-420px; width:min(420px, 86vw); height:100%;
  background:#fff; border-left:1px solid var(--border); box-shadow:-4px 0 18px rgba(0,0,0,0.18);
  z-index:9; transition:right .28s ease; display:flex; flex-direction:column;
}
.drawer--open{ right:0; }
.drawer__header{
  padding:12px 14px; border-bottom:1px solid var(--border);
  display:flex; align-items:center; justify-content:space-between;
}
.drawer__title{ font-weight:600; }
.drawer__close{ height:28px; width:28px; border:1px solid var(--border); border-radius:8px; background:#fff; cursor:pointer; }
.drawer__body{ padding:14px; overflow:auto; }

.section{ margin-bottom:16px; }
.section__title{ font-weight:600; margin-bottom:8px; }
.kv{ list-style:none; padding:0; margin:0; }
.kv li{ margin-bottom:6px; }
.chunk{
  white-space:pre-wrap;
  border:1px solid var(--border);
  border-radius:8px;
  padding:10px;
  background:#fafafa;
  margin-bottom:10px;
}

/* ====== Misc ====== */
.center{
  height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px;
}
.spinner{
  width:24px; height:24px; border:3px solid #e3e6ef; border-top-color: var(--brand); border-radius:50%;
  animation: spin 1s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg) } }

.muted{ color: var(--muted); }

/* make the whole app use full height */
html, body, #root { height: 100%; }
body { margin: 0; }

/* app structure */
.app-shell { display: flex; flex-direction: column; height: 100%; }

/* topbar stays natural height; body fills the rest */
.shell-body { display: flex; flex: 1 1 auto; min-height: 0; }

/* left chat column */
.shell-left { flex: 0 0 360px; min-width: 300px; max-width: 480px;
  border-right: 1px solid var(--line, #e9ecef); min-height: 0; }

/* right graph column */
.shell-right { flex: 1 1 auto; min-width: 0; min-height: 0; display: flex; }

/* panel hosting the graph */
.panel.graph-host { flex: 1 1 auto; display: flex; min-height: 0; overflow: hidden; }

/* the actual graph viewport that GraphCanvas measures */
.graph-viewport { position: relative; width: 100%; height: 100%; min-height: 0; }

/* make sure the canvas fills and removes stray gaps */
.graph-viewport canvas { display: block; width: 100% !important; height: 100% !important; }

/* optional: a subtle background to avoid stark white */
:root { --panel: #fafafa; }
.dark :root, [data-theme="dark"] { --panel: #0b0e14; }
